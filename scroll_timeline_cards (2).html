<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Timeline GSAP Cards</title>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@600&family=Azaret+Mono&display=swap" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Work Sans', sans-serif;
      background: transparent;
      color: #fff;
      overflow: hidden;
    }

    .scroll-wrapper {
      position: fixed;
      inset: 0;
      overflow-y: scroll;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .scroll-wrapper::-webkit-scrollbar {
      display: none;
    }

    .timeline-container {
      position: relative;
      width: 100vw;
      min-height: 400vh;
    }

    .timeline-svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    path {
      fill: none;
      stroke: url(#gradientStroke);
      stroke-width: 3.5;
    }

    circle.dot {
      fill: #ff4e27;
      filter: drop-shadow(0 0 10px #ff4e27bb);
    }

    .card-step {
      position: absolute;
      min-width: 260px;
      max-width: 340px;
      opacity: 0;
      pointer-events: auto;
      z-index: 3;
      transition: box-shadow 0.3s, opacity 0.3s;
      will-change: transform, opacity;
      cursor: pointer;
      transform: translate(-50%, 0);
    }

    .card {
      background: rgba(30, 30, 30, 0.94);
      border: 1.5px solid #ff4e27aa;
      border-radius: 18px;
      padding: 20px 24px;
      box-shadow: 0 4px 48px #0008;
      backdrop-filter: blur(14px) saturate(120%);
      transition: box-shadow 0.2s;
    }

    .card:hover {
      box-shadow: 0 2px 36px #ff4e27cc;
    }

    .card h3 {
      font-size: 22px;
      margin: 0 0 10px;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .card p {
      font-size: 13px;
      font-family: 'Azaret Mono', monospace;
      margin: 0;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 99;
    }

    .overlay .content {
      background: rgba(30, 30, 34, 0.9);
      padding: 30px;
      border-radius: 16px;
      max-width: 480px;
      width: 90%;
      box-shadow: 0 8px 60px rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(20px);
    }

    .overlay .content h2 {
      margin-top: 0;
      margin-bottom: 12px;
    }
  </style>
</head>
<body>
  <div class="scroll-wrapper" id="scrollWrapper">
    <div class="timeline-container" id="container">
      <svg class="timeline-svg" id="timelineSvg">
        <defs>
          <linearGradient id="gradientStroke" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#FF4E27" />
            <stop offset="100%" stop-color="#ffffff11" />
          </linearGradient>
        </defs>
        <path id="path"></path>
        <circle class="dot" id="dot" r="10"></circle>
      </svg>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="content" id="overlayContent"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script>
    gsap.registerPlugin(ScrollTrigger);

    const scrollWrapper = document.getElementById('scrollWrapper');
    const container = document.getElementById('container');
    const svg = document.getElementById('timelineSvg');
    const pathEl = document.getElementById('path');
    const dot = document.getElementById('dot');
    const overlay = document.getElementById('overlay');
    const overlayContent = document.getElementById('overlayContent');

    const content = [
      "Beschreibung zu Schritt 1",
      "Beschreibung zu Schritt 2",
      "Beschreibung zu Schritt 3",
      "Beschreibung zu Schritt 4",
      "Beschreibung zu Schritt 5",
      "Beschreibung zu Schritt 6",
      "Beschreibung zu Schritt 7",
      "Beschreibung zu Schritt 8",
      "Beschreibung zu Schritt 9"
    ];

    const cardEls = [];
    function getCardPositions() {
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const totalHeight = container.scrollHeight || vh * 4;
      const minTop = vh * 0.2;
      const maxTop = totalHeight - vh * 0.2;
      return content.map((_, i) => {
        const y = minTop + (i / (content.length - 1)) * (maxTop - minTop);
        const x = (i % 2 ? vw * 0.7 : vw * 0.3);
        return { x, y };
      });
    }

    function createCards(cardPositions) {
      cardEls.length = 0;
      document.querySelectorAll('.card-step').forEach(el => el.remove());
      content.forEach((text, i) => {
        const pos = cardPositions[i];
        if (!pos) return;
        const cardWrap = document.createElement('div');
        cardWrap.className = 'card-step';
        cardWrap.innerHTML = `<div class='card'><h3>Schritt ${i + 1}</h3><p>${text}</p></div>`;
        cardWrap.style.left = `${pos.x}px`;
        cardWrap.style.top = `${pos.y}px`;
        container.appendChild(cardWrap);
        cardEls.push(cardWrap);
        cardWrap.addEventListener('click', () => {
          overlayContent.innerHTML = `<h2>Schritt ${i + 1}</h2><p>${text}</p>`;
          overlay.style.display = 'flex';
        });
      });
    }

    overlay.addEventListener('click', () => overlay.style.display = 'none');

    function drawPath(cardPositions) {
      if (!cardPositions.length) return;
      let d = `M${cardPositions[0].x},${cardPositions[0].y}`;
      for (let i = 1; i < cardPositions.length; i++) {
        d += ` L${cardPositions[i].x},${cardPositions[i].y}`;
      }
      pathEl.setAttribute('d', d);
    }

    function setCardVisibility() {
      const vh = window.innerHeight;
      cardEls.forEach(card => {
        const rect = card.getBoundingClientRect();
        card.style.opacity = rect.top < vh * 0.9 && rect.bottom > vh * 0.1 ? 1 : 0;
      });
    }

    function updateEverything() {
      const positions = getCardPositions();
      createCards(positions);
      drawPath(positions);

      const length = pathEl.getTotalLength();
      pathEl.style.strokeDasharray = length;
      pathEl.style.strokeDashoffset = length;

      ScrollTrigger.killAll();
      ScrollTrigger.scrollerProxy(scrollWrapper, {
        scrollTop(value) {
          if (arguments.length) scrollWrapper.scrollTop = value;
          return scrollWrapper.scrollTop;
        },
        getBoundingClientRect() {
          return {
            top: 0,
            left: 0,
            width: window.innerWidth,
            height: window.innerHeight
          };
        }
      });

      ScrollTrigger.defaults({ scroller: scrollWrapper });

      ScrollTrigger.create({
        trigger: container,
        start: "top top",
        end: "bottom bottom",
        scrub: 1,
        onUpdate: self => {
          pathEl.style.strokeDashoffset = length * (1 - self.progress);
          const pt = pathEl.getPointAtLength(length * self.progress);
          dot.setAttribute('cx', pt.x);
          dot.setAttribute('cy', pt.y);
        }
      });

      ScrollTrigger.refresh();
      setCardVisibility();
    }

    scrollWrapper.addEventListener('scroll', setCardVisibility);
    window.addEventListener('resize', updateEverything);
    window.addEventListener('load', updateEverything);
    setTimeout(updateEverything, 100);
  </script>
</body>
</html>
